<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥èº«è¿åŠ¨è®¡æ—¶å™¨</title>
    <style>
        /* å®šä¹‰é…è‰²æ–¹æ¡ˆ */
        :root {
            --color-cream: #fef7ec; /* å¥¶ç™½ */
            --color-beige: #e6d2c3; /* æµ…å’–/ç±³ */
            --color-brown: #8b7355; /* æ£•å’– */
            --color-dark: #5a4a3a; /* æ·±ç°å’– */
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--color-cream);
            color: var(--color-dark);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background-color: white;
            padding: 2.5rem;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(139, 115, 85, 0.1);
            text-align: center;
            width: 100%;
            max-width: 450px;
            border: 1px solid var(--color-beige);
        }

        h1 {
            color: var(--color-dark);
            margin-bottom: 2rem;
            font-weight: 400;
        }

        .settings {
            display: flex;
            justify-content: space-around;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 10px;
        }

        .setting-group {
            text-align: center;
            flex: 1;
            min-width: 80px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: var(--color-brown);
        }

        select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--color-beige);
            border-radius: 8px;
            background-color: white;
            color: var(--color-dark);
            font-size: 1rem;
            cursor: pointer;
        }

        .display {
            margin: 2rem 0;
            padding: 1.5rem;
            border-radius: 12px;
            transition: background-color 0.3s ease;
        }

        /* è¿åŠ¨çŠ¶æ€æ ·å¼ */
        .status-work {
            background-color: rgba(230, 210, 195, 0.3); /* æµ…å’–è‰²èƒŒæ™¯ */
            border: 2px solid var(--color-brown);
        }

        /* é—´æ­‡çŠ¶æ€æ ·å¼ */
        .status-rest {
            background-color: rgba(139, 115, 85, 0.1); /* æ›´æµ…çš„å’–è‰²èƒŒæ™¯ */
            border: 2px solid var(--color-beige);
        }

        #currentPhase {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            font-weight: 300;
        }

        #timer {
            font-size: 4rem;
            font-weight: 200;
            letter-spacing: 2px;
            margin: 0.5rem 0;
            font-family: 'Courier New', monospace; /* ç­‰å®½å­—ä½“ï¼Œå€’è®¡æ—¶æ˜¾ç¤ºæ›´æ•´é½ */
        }

        #cycleInfo {
            font-size: 1rem;
            color: var(--color-brown);
            margin-top: 0.5rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 1.5rem;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        #startPauseBtn {
            background-color: var(--color-brown);
            color: white;
        }

        #startPauseBtn:hover {
            background-color: var(--color-dark);
        }

        #stopBtn {
            background-color: var(--color-beige);
            color: var(--color-dark);
        }

        #stopBtn:hover {
            background-color: #d4c1b0;
        }

        button:disabled {
            background-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
        }

        /* å®Œæˆæç¤ºçš„æ ·å¼ */
        .finished {
            background-color: rgba(139, 115, 85, 0.15) !important;
            border-color: var(--color-brown) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸƒ è¿åŠ¨è®¡æ—¶å™¨</h1>

        <div class="settings">
            <div class="setting-group">
                <label for="workTime">è¿åŠ¨ (åˆ†é’Ÿ)</label>
                <select id="workTime">
                    <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </select>
            </div>
            <div class="setting-group">
                <label for="restTime">é—´æ­‡ (ç§’)</label>
                <select id="restTime">
                    <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </select>
            </div>
            <div class="setting-group">
                <label for="cycles">å¾ªç¯æ¬¡æ•°</label>
                <select id="cycles">
                    <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </select>
            </div>
        </div>

        <div class="display" id="displayPanel">
            <div id="currentPhase">å‡†å¤‡å¼€å§‹</div>
            <div id="timer">--:--</div>
            <div id="cycleInfo">è®¾ç½®å‚æ•°åç‚¹å‡»å¼€å§‹</div>
        </div>

        <div class="controls">
            <button id="startPauseBtn">å¼€å§‹</button>
            <button id="stopBtn" disabled>åœæ­¢</button>
        </div>
    </div>

    <!-- ç”¨äºæ’­æ”¾æ»´ç­”å£°çš„éŸ³é¢‘å…ƒç´  -->
    <audio id="tickSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-metronome-600.mp3" type="audio/mp3">
        <!-- å¤‡é€‰éŸ³æºï¼Œå¦‚æœä¸Šé¢çš„é“¾æ¥å¤±æ•ˆå¯ä»¥ä½¿ç”¨è¿™ä¸ª -->
        <!-- <source src="https://soundbible.com/mp3/Clock-Ticking_Time-Bomb-Mike_Koenig-9072.mp3" type="audio/mp3"> -->
    </audio>

    <script>
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–DOMå…ƒç´ 
            const workTimeSelect = document.getElementById('workTime');
            const restTimeSelect = document.getElementById('restTime');
            const cyclesSelect = document.getElementById('cycles');
            const startPauseBtn = document.getElementById('startPauseBtn');
            const stopBtn = document.getElementById('stopBtn');
            const displayPanel = document.getElementById('displayPanel');
            const currentPhaseEl = document.getElementById('currentPhase');
            const timerEl = document.getElementById('timer');
            const cycleInfoEl = document.getElementById('cycleInfo');
            const tickSound = document.getElementById('tickSound');

            // åŠ¨æ€ç”Ÿæˆé€‰é¡¹
            function populateSelect(selectElement, min, max, unit = '') {
                for (let i = min; i <= max; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i + unit;
                    selectElement.appendChild(option);
                }
            }

            populateSelect(workTimeSelect, 1, 10, ' åˆ†é’Ÿ');
            populateSelect(restTimeSelect, 1, 60, ' ç§’');
            populateSelect(cyclesSelect, 1, 10, ' æ¬¡');

            // è®¾ç½®é»˜è®¤å€¼ï¼ˆç¤ºä¾‹ï¼šè¿åŠ¨1åˆ†é’Ÿï¼Œé—´æ­‡10ç§’ï¼Œå¾ªç¯3æ¬¡ï¼‰
            workTimeSelect.value = 1;
            restTimeSelect.value = 10;
            cyclesSelect.value = 3;

            // è®¡æ—¶å™¨çŠ¶æ€å˜é‡
            let timer = null;
            let isRunning = false;
            let isWorkPhase = true; // trueä¸ºè¿åŠ¨é˜¶æ®µï¼Œfalseä¸ºé—´æ­‡é˜¶æ®µ
            let currentCycle = 1;
            let timeLeft = 0; // å½“å‰é˜¶æ®µå‰©ä½™ç§’æ•°

            // åˆå§‹åŒ–æ˜¾ç¤º
            updateDisplay();

            // å¼€å§‹/æš‚åœæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            startPauseBtn.addEventListener('click', function() {
                if (!isRunning) {
                    // é¦–æ¬¡å¼€å§‹æˆ–æš‚åœåç»§ç»­
                    if (timeLeft === 0) {
                        // é¦–æ¬¡å¼€å§‹ï¼Œåˆå§‹åŒ–æ—¶é—´
                        startTimer();
                    } else {
                        // æš‚åœåç»§ç»­
                        resumeTimer();
                    }
                    startPauseBtn.textContent = 'æš‚åœ';
                    stopBtn.disabled = false;
                } else {
                    // æš‚åœ
                    pauseTimer();
                    startPauseBtn.textContent = 'ç»§ç»­';
                }
            });

            // åœæ­¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            stopBtn.addEventListener('click', function() {
                stopTimer();
                startPauseBtn.textContent = 'å¼€å§‹';
                stopBtn.disabled = true;
            });

            // å¼€å§‹è®¡æ—¶å™¨
            function startTimer() {
                isRunning = true;
                currentCycle = 1;
                isWorkPhase = true;
                // å°†åˆ†é’Ÿè½¬æ¢ä¸ºç§’
                timeLeft = parseInt(workTimeSelect.value) * 60;
                updateDisplay();
                runTimer();
            }

            // è¿è¡Œè®¡æ—¶å™¨ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
            function runTimer() {
                clearInterval(timer); // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨
                timer = setInterval(function() {
                    timeLeft--;

                    // æ’­æ”¾æ»´ç­”å£°ï¼ˆä»…åœ¨æœ€å10ç§’æˆ–ä»»ä½•ä¸€ç§’ï¼Œå¯æ ¹æ®å–œå¥½è°ƒæ•´ï¼‰
                    // if (timeLeft < 10 || true) { // å¦‚æœå¸Œæœ›æ¯ç§’éƒ½å“ï¼Œç”¨è¿™ä¸ª
                    if (timeLeft <= 10 || timeLeft % 5 === 0) { // æœ€å10ç§’åŠæ¯5ç§’å“ä¸€æ¬¡ï¼Œé¿å…å¤ªåµ
                        // å…‹éš†å¹¶æ’­æ”¾å£°éŸ³ï¼Œä»¥å®ç°å¿«é€Ÿè¿ç»­æ’­æ”¾
                        const tickClone = tickSound.cloneNode();
                        tickClone.volume = 0.3; // è®¾ç½®éŸ³é‡ï¼Œé¿å…å¤ªå¤§
                        tickClone.play().catch(e => console.log("éŸ³é¢‘æ’­æ”¾è¢«é˜»æ­¢ï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’åè‡ªåŠ¨æ’­æ”¾ï¼‰:", e));
                    }

                    updateDisplay();

                    if (timeLeft <= 0) {
                        // å½“å‰é˜¶æ®µç»“æŸ
                        clearInterval(timer);
                        handlePhaseEnd();
                    }
                }, 1000);
            }

            // æš‚åœè®¡æ—¶å™¨
            function pauseTimer() {
                isRunning = false;
                clearInterval(timer);
            }

            // ç»§ç»­è®¡æ—¶å™¨
            function resumeTimer() {
                isRunning = true;
                runTimer();
            }

            // åœæ­¢è®¡æ—¶å™¨
            function stopTimer() {
                isRunning = false;
                clearInterval(timer);
                timer = null;
                isWorkPhase = true;
                currentCycle = 1;
                timeLeft = 0;
                updateDisplay();
                displayPanel.classList.remove('finished');
            }

            // å¤„ç†ä¸€ä¸ªé˜¶æ®µç»“æŸ
            function handlePhaseEnd() {
                if (isWorkPhase) {
                    // è¿åŠ¨ç»“æŸï¼Œè¿›å…¥é—´æ­‡
                    isWorkPhase = false;
                    timeLeft = parseInt(restTimeSelect.value);
                } else {
                    // é—´æ­‡ç»“æŸï¼Œè¿›å…¥ä¸‹ä¸€è½®è¿åŠ¨æˆ–ç»“æŸ
                    currentCycle++;
                    if (currentCycle > parseInt(cyclesSelect.value)) {
                        // æ‰€æœ‰å¾ªç¯ç»“æŸ
                        timerComplete();
                        return;
                    } else {
                        // ä¸‹ä¸€è½®å¼€å§‹
                        isWorkPhase = true;
                        timeLeft = parseInt(workTimeSelect.value) * 60;
                    }
                }
                // å¼€å§‹æ–°é˜¶æ®µ
                runTimer();
                updateDisplay();
            }

            // è®¡æ—¶å™¨å…¨éƒ¨å®Œæˆ
            function timerComplete() {
                isRunning = false;
                currentPhaseEl.textContent = 'è®­ç»ƒå®Œæˆï¼';
                timerEl.textContent = '00:00';
                cycleInfoEl.textContent = `å·²å®Œæˆ ${cyclesSelect.value} ä¸ªå¾ªç¯`;
                displayPanel.classList.add('finished');

                // æ’­æ”¾å®Œæˆæç¤ºéŸ³ï¼ˆä½¿ç”¨æ»´ç­”å£°çš„éŸ³é¢‘ï¼Œæˆ–è€…å¯ä»¥æ‰¾å¦ä¸€ä¸ªéŸ³é¢‘ï¼‰
                const completeSound = tickSound.cloneNode();
                completeSound.volume = 0.5;
                // å¿«é€Ÿè¿ç»­æ’­æ”¾ä¸‰æ¬¡ä½œä¸ºå®Œæˆæç¤º
                completeSound.play();
                setTimeout(() => { completeSound.currentTime = 0; completeSound.play(); }, 300);
                setTimeout(() => { completeSound.currentTime = 0; completeSound.play(); }, 600);

                startPauseBtn.textContent = 'å¼€å§‹';
                stopBtn.disabled = true;
            }

            // æ›´æ–°æ˜¾ç¤ºé¢æ¿
            function updateDisplay() {
                // æ›´æ–°é˜¶æ®µæ–‡å­—å’Œæ ·å¼
                if (timeLeft === 0 && !isRunning) {
                    // åˆå§‹çŠ¶æ€æˆ–åœæ­¢å
                    currentPhaseEl.textContent = 'å‡†å¤‡å¼€å§‹';
                    displayPanel.className = 'display';
                } else {
                    if (isWorkPhase) {
                        currentPhaseEl.textContent = `è¿åŠ¨ä¸­ ç¬¬${currentCycle}/${cyclesSelect.value}è½®`;
                        displayPanel.className = 'display status-work';
                    } else {
                        currentPhaseEl.textContent = `é—´æ­‡ä¸­ ç¬¬${currentCycle}/${cyclesSelect.value}è½®`;
                        displayPanel.className = 'display status-rest';
                    }
                }

                // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                // æ›´æ–°å¾ªç¯ä¿¡æ¯
                if (isRunning) {
                    cycleInfoEl.textContent = isWorkPhase ? 'åšæŒä½ï¼' : 'ä¼‘æ¯ä¸€ä¸‹ï¼Œå‡†å¤‡ä¸‹ä¸€è½®';
                }
            }
        });
    </script>
</body>
</html>